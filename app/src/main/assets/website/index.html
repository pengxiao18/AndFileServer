<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Android File Server</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--<style>
        body{font-family: system-ui, sans-serif; max-width: 960px; margin: 40px auto; padding:0 16px;}
        input,button{padding:6px;}
        table{border-collapse:collapse;width:100%}
        td,th{border-bottom:1px solid #ddd;padding:6px;}
        a{text-decoration:none}
        .row:hover{background:#fafafa}

        #tbl th.size,     #tbl td.size,
        #tbl th.download, #tbl td.download,
        #tbl th.actions,  #tbl td.actions { text-align: center; }
        #tbl td.actions { white-space: nowrap; }
        #tbl td.actions button { margin-left: 0; } /* å¯é€‰ï¼šå»æ‰é»˜è®¤é—´è· */
    </style>-->
    <link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Android æ–‡ä»¶æœåŠ¡</h1>
<div>
    <label>è·¯å¾„ï¼š</label>
    <input id="p" value="{{rootDir}}" style="width:60%"/>
    <button onclick="load()">åˆ—å‡º</button>
    <input type="file" id="file" multiple/>
    <button onclick="upload()">ä¸Šä¼ </button>
    <button onclick="mkdir()">æ–°å»ºæ–‡ä»¶å¤¹</button>
</div>
<table id="tbl">
    <thead>
    <tr>
        <th>åç§°</th>
        <th>å¤§å°</th>
        <th>ä¸‹è½½</th>
        <th>åˆ é™¤</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>
<script>
    // ç”±æœåŠ¡å™¨åœ¨è¿”å›æ—¶æŠŠ __TOKEN__ æ›¿æ¢æˆçœŸå® token
    window.token = "__TOKEN__";
    window.diskDir = "{{rootDir}}"
</script>
<script src="main.js"></script>
<!--<script>-->
<!--    // ç”±æœåŠ¡å™¨åœ¨è¿”å›æ—¶æŠŠ __TOKEN__ æ›¿æ¢æˆçœŸå® token-->
<!--    const token = "__TOKEN__";-->

<!--     const $ = s => document.querySelector(s), tbody = $("#tbl tbody");-->

<!--      // ä»…ç”¨ URL Hash è®°ä½ç›®å½•-->
<!--      const getPath = ()=>{-->
<!--        const h = location.hash.slice(1);-->
<!--        try { return h ? decodeURIComponent(h) : "/sdcard"; } catch { return "/sdcard"; }-->
<!--      };-->
<!--      const setHash = (p)=>{-->
<!--        const nh = "#"+encodeURIComponent(p);-->
<!--        if (location.hash !== nh) location.hash = nh;-->
<!--      };-->

<!--      // âœ… åˆ·æ–°/å‰è¿›/åé€€ï¼šæ ¹æ® hash æ¢å¤ï¼Œå¹¶ä¸”é¦–è½®åŠ è½½ä¸è¦å†æ”¹ hash-->
<!--      window.addEventListener("hashchange", () => {-->
<!--        const p = getPath();-->
<!--        if ($("#p").value !== p) { $("#p").value = p; load(true); } // true = æœ¬æ¬¡ä¸å†™ hash-->
<!--      });-->

<!--     // âœ… åˆå§‹åŒ–é¡ºåºï¼šå…ˆç”¨ hash è¦†ç›–è¾“å…¥æ¡†ï¼Œå†åšâ€œé¦–è½®åŠ è½½ï¼ˆä¸å†™ hashï¼‰â€-->
<!--     document.addEventListener("DOMContentLoaded", () => {-->
<!--        $("#p").value = getPath();  // å…ˆæ¢å¤-->
<!--        load(true);                 // é¦–æ¬¡åŠ è½½ä¸è¦†ç›– hash-->
<!--      });-->

<!--    async function load(skipHash = false){-->
<!--      // const path = document.getElementById('p').value;-->
<!--      const path = $("#p").value;-->
<!--      if (!skipHash) setHash(path);      // åªæœ‰ç”¨æˆ·æ˜¾å¼åˆ‡ç›®å½•æ—¶æ‰æ›´æ–° hash-->

<!--      const res = await fetch(`/ls?path=${encodeURIComponent(path)}`, {headers:{'X-Token':token}});-->
<!--      if(!res.ok){ alert(await res.text()); return; }-->
<!--      const data = await res.json();-->
<!--      const tb = document.querySelector('#tbl tbody'); tb.innerHTML='';-->
<!--      if(path!=='/'){-->
<!--        const parent = path.replace(/\/+$/,'').split('/').slice(0,-1).join('/') || '/';-->
<!--        tb.insertAdjacentHTML('beforeend', `<tr class="row">-->
<!--        <td><a href="#" onclick="document.getElementById('p').value='${parent}';load();return false;">..</a></td>-->
<!--        <td class="size"></td>-->
<!--        <td class="download"></td>-->
<!--        <td class="actions"></td>-->
<!--        </tr>`);-->
<!--      }-->
<!--      for(const it of data){-->
<!--        if(it.isDir){-->
<!--          tb.insertAdjacentHTML('beforeend', `<tr class="row">-->
<!--            <td>ğŸ“ <a href="#" onclick="document.getElementById('p').value='${it.path}';load();return false;">${it.name}</a></td>-->
<!--            <td class="size">-</td>-->
<!--            <td class="download">-</td>  &lt;!&ndash; æ— ä¸‹è½½ï¼Œå ä½ &ndash;&gt;-->
<!--            <td class="actions"><button onclick="del('${it.path}')">åˆ é™¤</button></td></tr>`.replace(/it\.path/g, it.path).replace(/it\.name/g, it.name));-->
<!--        } else {-->
<!--          tb.insertAdjacentHTML('beforeend', `<tr class="row">-->
<!--            <td>ğŸ“„ ${it.name}</td>-->
<!--            <td class="size">${it.size}</td>-->
<!--            <td class="download"><a href="/dl?path=${encodeURIComponent(it.path)}" target="_blank">ä¸‹è½½</a></td>-->
<!--            <td class="actions"><button onclick="del('${it.path}')">åˆ é™¤</button></td></tr>`);-->
<!--        }-->
<!--      }-->
<!--    }-->

<!--    async function del(p){-->
<!--      if(!confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) return;-->
<!--      await fetch('/rm', {method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded','X-Token':token}, body:`path=${encodeURIComponent(p)}`});-->
<!--      load();-->
<!--    }-->

<!--    async function mkdir(){-->
<!--      const path = document.getElementById('p').value;-->
<!--      const name = prompt('æ–‡ä»¶å¤¹å'); if(!name) return;-->
<!--      await fetch('/mkdir', {method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded','X-Token':token}, body:`path=${encodeURIComponent(path)}&name=${encodeURIComponent(name)}`});-->
<!--      load();-->
<!--    }-->

<!--    async function upload(){-->
<!--      const path = document.getElementById('p').value;-->
<!--      const files = document.getElementById('file').files;-->
<!--      const form = new FormData();-->
<!--      for(const f of files) form.append('file', f);-->
<!--      const res = await fetch(`/upload?path=${encodeURIComponent(path)}`, {method:'POST', headers:{'X-Token':token}, body:form});-->
<!--      alert(await res.text()); load();-->
<!--    }-->

<!--    // load();-->
<!--</script>-->
</body>
</html>
